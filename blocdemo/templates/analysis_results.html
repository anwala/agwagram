{% extends "base.html" %}

{% block title %}
Results | B3T
{% endblock %}

{% block content %}

<div class="content-header">
    <div class="content-header-intro">
        <h1>BLOC Analysis</h1> 
        <p>Successfully generated results for
        {% for account in account_blocs %}
            <b>@{{account.account_username}}</b>, 
        {% endfor %}
        </p>
    </div>
    <div class="content-header-actions">
        <!--<button>
            <span class="icon material-symbols-outlined">bolt</span>
            <span>Button 1</span>
        </button>
        <button>
            <span class="icon material-symbols-outlined">settings</span>
            <span>Button 2</span>
        </button>-->
    </div>
</div>
{% for account in  account_blocs %}
<div class="content">
    <div class="content-subheader">
        <h2>Analysis of <span class="special-text">@{{account.account_username}}</span> (<i>{{account.account_name}}</i>)</h2>
        {% if account.tweet_count > 0 %}
        <p>Results generated using {{account.tweet_count}} tweets from {{account.first_tweet_date}} - {{account.last_tweet_date}}. 
            BLOC process took {{account.elapsed_time}} seconds to complete.</p>
        {% else %}
        <p>No results generated due to finding 0 tweets. 
            BLOC process took {{account.elapsed_time}} seconds to complete.</p>
        {% endif %}
    </div>
    <div class="content-main">
        {% if account.tweet_count > 0 %}
        <div class="card-grid">
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">bolt</span>
                        <h3>Top BLOC Words</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <table>
                        <tr>
                          <th>BLOC Word</th>
                          <th>Frequency</th>
                          <th>Rate</th>
                        </tr>
                        {% for word in account.top_bloc_words %}
                        <tr>
                          <td>{{word.term}}</td>
                          <td>{{word.term_freq}}</td>
                          <td>{{word.term_rate}}</td>
                        </tr>
                        {% endfor %}
                      </table>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">bolt</span>
                        <h3>Action Analysis</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the action analysis.</p>
                </div>
                <div class="card-body">
                    <p>{{account.bloc_action|safe}}</p>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">bolt</span>
                        <h3>Content Syntactic</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the content syntactic analysis.</p>
                </div>
                <div class="card-body">
                    <p>{{account.bloc_content_syntactic|safe}}</p>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">bolt</span>
                        <h3>Content Semantic</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the content semantic analysis.</p>
                </div>
                <div class="card-body">
                    <p>{{account.bloc_content_semantic|safe}}</p>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
        </div>
        {% endif %}
    </div>
</div>
{% endfor %}

<script>
function cardToggle(item) {
    console.log(item.checked);
    var cardDropdown = item.parentElement.parentElement.nextElementSibling;
    console.log(cardDropdown);
    if(item.checked) {
        cardDropdown.classList.add("active");
    } else {
        cardDropdown.classList.remove("active");
    }
}

function calculateCardOffsetHeights() {
    const cardToggleBodies = document.querySelectorAll('.card-toggle-body');
    for (const cardToggleBody of cardToggleBodies) {
        var extendedHeight = 24;
        for (let i = 0; i < cardToggleBody.children.length; i++) {
            extendedHeight += cardToggleBody.children[i].offsetHeight;
        }
    cardToggleBody.style.setProperty('--extended-height', extendedHeight.toString() + "px");
    }
}

window.addEventListener('load', () => {
    calculateCardOffsetHeights();
});

window.addEventListener('resize', function() {
    calculateCardOffsetHeights();
});

</script>

{% endblock %}