{% extends "base.html" %}

{% block title %}
Results | B3T
{% endblock %}

{% block content %}

<div class="content-header">
    <div class="content-header-intro">
        <h1>BLOC Analysis</h1> 
        <p>Successfully generated results for
        {% for account in account_blocs %}
            <b>@{{account.account_username}}</b>{% if forloop.last %}.{% else %},{% endif %}
        {% endfor %}
        </p>
    </div>
    <div class="content-header-actions">
        <div class="tab-buttons">
        {% for account in account_blocs %}
            <button class="tab-button" onclick="openTab(event, 'content-{{ forloop.counter }}')">{{account.account_username}}</button>
        {% endfor %}
        </div>
    </div>
</div>
{% for account in account_blocs %}
<div class="content" id="content-{{ forloop.counter }}">
    <div class="content-subheader">
        <h2>Analysis of <span class="special-text">@{{account.account_username}}</span> (<i>{{account.account_name}}</i>)</h2>
        {% if account.tweet_count > 0 %}
        <p>Results generated using {{account.tweet_count}} tweets from {{account.first_tweet_date}} - {{account.last_tweet_date}}. 
            BLOC process took {{account.elapsed_time}} seconds to complete.</p>
        {% else %}
        <p>No results generated due to finding 0 tweets. 
            BLOC process took {{account.elapsed_time}} seconds to complete.</p>
        {% endif %}
    </div>
    {% include '../components/account_bloc.html' with account=account %}
</div>
{% endfor %}

<script>
function cardToggle(item) {
    console.log(item.checked);
    var cardDropdown = item.parentElement.parentElement.nextElementSibling;
    console.log(cardDropdown);
    if(item.checked) {
        cardDropdown.classList.add("active");
    } else {
        cardDropdown.classList.remove("active");
    }
}

function calculateCardOffsetHeights() {
    const cardToggleBodies = document.querySelectorAll('.card-toggle-body');
    for (const cardToggleBody of cardToggleBodies) {
        var extendedHeight = 24;
        for (let i = 0; i < cardToggleBody.children.length; i++) {
            extendedHeight += cardToggleBody.children[i].offsetHeight;
        }
    cardToggleBody.style.setProperty('--extended-height', extendedHeight.toString() + "px");
    }
}

window.addEventListener('load', () => {
    calculateCardOffsetHeights();
});

window.addEventListener('resize', function() {
    calculateCardOffsetHeights();
});
</script>
<script>
function openTab(evt, tabName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="content" and hide them
    tabcontent = document.getElementsByClassName("content");
    for (i = 0; i < tabcontent.length; i++) {
        if(!tabcontent[i].classList.contains('inactive')) {
            tabcontent[i].classList.add('inactive');
        }
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tab-button");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(tabName).classList.remove('inactive');
    evt.currentTarget.className += " active";
    calculateCardOffsetHeights();
}

window.addEventListener('load', () => {
    tablinks = document.getElementsByClassName("tab-buttons");
    tablinks[0].click();
});
</script>

{% endblock %}