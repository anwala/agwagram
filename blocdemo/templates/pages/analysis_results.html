{% extends "base.html" %}

{% block title %}
Results | B3T
{% endblock %}

{% block content %}
{% load custom_filters %}

<div class="content-header">
    <div class="content-header-intro">
        <h1>BLOC Analysis</h1> 
        <p>Successfully generated results for
        {% for account in account_blocs %}
            <b>@{{account.account_username}}</b>{% if forloop.last %}.{% else %},{% endif %}
        {% endfor %}
        </p>
    </div>
    <div class="content-header-actions">
    </div>
</div>
<div class="tab-buttons">
    <button class="tab-button active" onclick="openTab(event, 'content-group')">Group Analysis &nbsp;<span class="icon material-symbols-outlined">groups</span></button>
    {% for account in account_blocs %}
        <button class="tab-button" onclick="openTab(event, 'content-{{ forloop.counter }}')">@{{account.account_username}}</button>
    {% endfor %}
</div>
<div class="content" id="content-group">
    <div class="content-subheader">
        <div>
            <h2>Group Analysis</h2>
            <p>Aggregate behaviour based on a combined {{total_tweets}} tweets from the following accounts:  
            {% for account in account_blocs %}
                <span class="special-text">@{{account.account_username}}</span>{% if forloop.last %}.{% else %}, {% endif %}
            {% endfor %}
            </p>
        </div>
    </div>
    <div class="content-main">
        <div class="card-grid">
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">star_half</span>
                        <h3>Top Actions</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <div class="scrollable">
                        <table>
                            <tr>
                                <th class="table-main">Action</th>
                                <th>Rate</th>
                            </tr>
                            {% for word in group_top_actions %}
                            <tr>
                                <td>
                                    {% for char in word.term %}
                                        <div class="hoverable-text">
                                            {{ char|get_description }}
                                            <span class="hoverable-tooltip">{{ char }}</span>
                                        </div>
                                        {% if not forloop.last %},&nbsp;{% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{word.term_rate}} ({{word.term_freq}})</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">star_half</span>
                        <h3>Top Syntactic Format</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <div class="scrollable">
                        <table>
                            <tr>
                                <th class="table-main">Action</th>
                                <th>Rate</th>
                            </tr>
                            {% for word in group_top_syntactic %}
                            <tr>
                                <td>
                                    {% for char in word.term %}
                                        <div class="hoverable-text">
                                            {{ char|get_description }}
                                            <span class="hoverable-tooltip">{{ char }}</span>
                                        </div>
                                        {% if not forloop.last %},&nbsp;{% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{word.term_rate}} ({{word.term_freq}})</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">star_half</span>
                        <h3>Top Semantic Entities</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <div class="scrollable">
                        <table>
                            <tr>
                                <th class="table-main">Action</th>
                                <th>Rate</th>
                            </tr>
                            {% for word in group_top_semantic %}
                            <tr>
                                <td>
                                    {% for char in word.term %}
                                        <div class="hoverable-text">
                                            {{ char|get_description }}
                                            <span class="hoverable-tooltip">{{ char }}</span>
                                        </div>
                                        {% if not forloop.last %},&nbsp;{% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{word.term_rate}} ({{word.term_freq}})</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">star_half</span>
                        <h3>Top Sentiments</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <div class="scrollable">
                        <table>
                            <tr>
                                <th class="table-main">Action</th>
                                <th>Rate</th>
                            </tr>
                            {% for word in group_top_sentiment %}
                            <tr>
                                <td>
                                    {% for char in word.term %}
                                        <div class="hoverable-text">
                                            {{ char|get_description }}
                                            <span class="hoverable-tooltip">{{ char }}</span>
                                        </div>
                                        {% if not forloop.last %},&nbsp;{% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{word.term_rate}} ({{word.term_freq}})</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">star_half</span>
                        <h3>Top Time Delays Between Tweets</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the BLOC word frequency analysis.</p>
                </div>
                <div class="card-body">
                    <div class="scrollable">
                        <table>
                            <tr>
                                <th class="table-main">Action</th>
                                <th>Rate</th>
                            </tr>
                            {% for word in group_top_time %}
                            <tr>
                                <td>
                                    {% for char in word.term %}
                                        <div class="hoverable-text">
                                            {{ char|get_description }}
                                            <span class="hoverable-tooltip">{{ char }}</span>
                                        </div>
                                        {% if not forloop.last %},&nbsp;{% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{word.term_rate}} ({{word.term_freq}})</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
            <article class="card">
                <div class="card-header">
                    <div>
                        <span class="icon material-symbols-outlined">compare_arrows</span>
                        <h3>Pairwise Similarity</h3>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" onChange="cardToggle(this)">
                        <span></span>
                    </label>
                </div>
                <div class="card-toggle-body">
                    <p>This is more information about the pairwise similarity calculation.</p>
                </div>
                <div class="card-body">
                    <table>
                        <tr>
                            <th>Similarity</th>
                            <th>Account 1</th>
                            <th>Account 2</th>
                        </tr>
                        {% for u_pair in pairwise_sim %}
                        <tr>
                            <td>{{u_pair.sim}}</td>
                            <td>{{u_pair.user_pair.0}}</td>
                            <td>{{u_pair.user_pair.1}}</td>
                        </tr>
                        {% endfor %}
                        </table>
                </div>
                <div class="card-footer">
                    <a href="methodology">More Details</a>
                </div>
            </article>
        </div>
    </div>
</div>
{% for account in account_blocs %}
<div class="content inactive" id="content-{{ forloop.counter }}">
    <div class="content-subheader">
        <div>
            <h2>Analysis of <span class="special-text">@{{account.account_username}}</span> (<i>{{account.account_name}}</i>)</h2>
            {% if account.tweet_count > 0 %}
            <p>Results generated using {{account.tweet_count}} tweets from {{account.first_tweet_date}} - {{account.last_tweet_date}}. 
                BLOC process took {{account.elapsed_time}} seconds to complete.</p>
            {% else %}
            <p>No results generated due to finding 0 tweets. 
                BLOC process took {{account.elapsed_time}} seconds to complete.</p>
            {% endif %}
        </div>
    </div>
    {% include '../components/account_bloc.html' with account=account %}
</div>
{% endfor %}

<script>
function cardToggle(item) {
    console.log(item.checked);
    var cardDropdown = item.parentElement.parentElement.nextElementSibling;
    console.log(cardDropdown);
    if(item.checked) {
        cardDropdown.classList.add("active");
    } else {
        cardDropdown.classList.remove("active");
    }
}

function calculateCardOffsetHeights() {
    const cardToggleBodies = document.querySelectorAll('.card-toggle-body');
    for (const cardToggleBody of cardToggleBodies) {
        var extendedHeight = 24;
        for (let i = 0; i < cardToggleBody.children.length; i++) {
            extendedHeight += cardToggleBody.children[i].offsetHeight;
        }
    cardToggleBody.style.setProperty('--extended-height', extendedHeight.toString() + "px");
    }
}

window.addEventListener('load', () => {
    calculateCardOffsetHeights();
});

window.addEventListener('resize', function() {
    calculateCardOffsetHeights();
});
</script>
<script>
function openTab(event, tabName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="content" and hide them
    tabcontent = document.getElementsByClassName("content");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.add('inactive');
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tab-button");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(tabName).classList.remove("inactive");
    event.currentTarget.classList.add("active");
    calculateCardOffsetHeights();
}
</script>

{% endblock %}